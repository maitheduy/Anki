<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>H·ªçc c√πng AI - C√¥ng c·ª• To√†n NƒÉng</title>
    
    <!-- Fonts and Icons -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@500;600;700&family=Baloo+2:wght@400;700;800&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css" rel="stylesheet">
    
    <!-- Tailwind CSS (B·∫Øt bu·ªôc cho Tr√¨nh qu·∫£n l√Ω Prompt) -->
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
        /* === CSS CH√çNH C·ª¶A TO√ÄN B·ªò TRANG === */
        :root {
            --primary-color: #00a8e8; --secondary-color: #ffd60a; --accent-color: #4CAF50; --youtube-color: #FF0000;
            --bg-color: #fefae0; --card-bg: #ffffff; --text-color: #3d405b; --primary-text: #0077b6;
            --border-color: #e0e0e0; --shadow-color: rgba(0, 168, 232, 0.15);
        }
        body { font-family: 'Quicksand', 'Baloo 2', cursive, sans-serif; background-color: var(--bg-color); color: var(--text-color); margin: 0; padding: 20px; line-height: 1.7; }
        .container { max-width: 1400px; margin: 0 auto; background-color: var(--card-bg); border-radius: 20px; padding: 30px; box-shadow: 0 10px 40px var(--shadow-color); border: 2px solid #fae19d; }
        
        h1 { 
            font-family: 'Baloo 2', cursive;
            text-align: center; margin-bottom: 25px; 
            font-size: 3.5em; 
            font-weight: 800;
            background: linear-gradient(90deg, var(--primary-color), var(--accent-color)); 
            -webkit-background-clip: text; 
            -webkit-text-fill-color: transparent;
            text-shadow: 2px 2px 6px rgba(0,0,0,0.05);
        }
        
        h2 { color: var(--primary-text); font-weight: 700; border-bottom: 3px dashed var(--primary-color); padding-bottom: 10px; margin-top: 0; margin-bottom: 20px; font-size: 1.6em; }
        .main-layout { display: flex; gap: 30px; flex-wrap: wrap; }
        .main-content { flex: 3; min-width: 350px; }
        .sidebar { flex: 1; min-width: 300px; }
        .step-card, .widget-card { background-color: #fdfdfd; border: 1px solid var(--border-color); border-radius: 15px; padding: 25px; margin-bottom: 25px; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05); }
        textarea, input[type="text"].log-input { width: 100%; padding: 12px; border: 2px solid var(--border-color); border-radius: 12px; font-family: 'Quicksand', sans-serif; font-size: 1em; margin-bottom: 10px; box-sizing: border-box; transition: border-color 0.3s, box-shadow 0.3s; }
        textarea:focus, input[type="text"].log-input:focus { outline: none; border-color: var(--primary-color); box-shadow: 0 0 0 4px var(--shadow-color); }
        .btn { display: inline-flex; align-items: center; justify-content: center; gap: 10px; padding: 12px 25px; border: none; border-radius: 30px; font-family: 'Baloo 2', cursive, sans-serif; font-size: 1.1em; font-weight: 600; cursor: pointer; transition: all 0.3s ease; text-decoration: none; color: white; letter-spacing: 0.5px; }
        .btn:hover { transform: translateY(-3px); }
        .btn-secondary { background-color: var(--primary-color); box-shadow: 0 4px 15px 0 rgba(0, 168, 232, 0.4); }
        .btn-secondary:hover { background-color: #0095d1; }
        .btn-accent { background-color: var(--accent-color); box-shadow: 0 4px 15px 0 rgba(76, 175, 80, 0.4); }
        .btn-accent:hover { background-color: #43a047; }
        .btn-youtube { background-color: var(--youtube-color); box-shadow: 0 4px 15px 0 rgba(255, 0, 0, 0.4); }
        .btn-youtube:hover { background-color: #d60000; }
        
        /* CSS CHO MODAL (D√πng chung) */
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.6); display: none; align-items: flex-start; justify-content: center; z-index: 1000; padding-top: 5vh; overflow-y: auto; }
        .modal-container { background: white; padding: 25px; border-radius: 15px; width: 95%; max-width: 1000px; box-shadow: 0 5px 20px rgba(0,0,0,0.3); max-height: 90vh; display: flex; flex-direction: column;}
        .modal-header { display: flex; justify-content: space-between; align-items: center; padding-bottom: 15px; border-bottom: 1px solid #ccc; margin-bottom: 15px;}
        #modal-content-wrapper, .modal-body { flex-grow: 1; overflow-y: auto; padding-right: 15px; margin-right: -15px;}
        .modal-close-btn { background: none; border: none; font-size: 2.5rem; font-weight: bold; color: #aaa; cursor: pointer; line-height: 1; transition: color 0.2s; }
        .modal-close-btn:hover { color: #f44336; }

        /* CSS cho S·ªï tay b√†i h·ªçc */
        #learning-log-list { list-style: none; padding: 0; margin-top: 20px; }
        #learning-log-list li { background: #f0f8ff; padding: 15px; border-radius: 10px; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center; transition: background-color 0.2s; }
        #learning-log-list li:hover { background-color: #e6f3ff; }
        #learning-log-list .log-title { font-weight: 600; cursor: pointer; color: #005a8d; }
        #learning-log-list .log-actions button { background: none; border: none; cursor: pointer; font-size: 1rem; margin-left: 10px; }
        #learning-log-list .edit-log-btn { color: #2196F3; }
        #learning-log-list .delete-log-btn { color: #f44336; }

        /* CSS cho Tr√¨nh qu·∫£n l√Ω Prompt */
        .mic-button { transition: all 0.3s ease; padding: 0.5rem; border-radius: 50%; }
        .mic-button.recording { background-color: #f87171; color: white; animation: pulse 1.5s infinite; }
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(248, 113, 113, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(248, 113, 113, 0); }
            100% { box-shadow: 0 0 0 0 rgba(248, 113, 113, 0); }
        }
        #voice-status { text-align: center; color: #6b7280; margin-top: 0.5rem; min-height: 1.5rem; }
    </style>
</head>
<body>
    <!-- === GIAO DI·ªÜN CH√çNH C·ª¶A TRANG === -->
    <div class="container">
        <h1><i class="fa-solid fa-shapes"></i> H·ªçc c√πng AI</h1>
        <div class="main-layout">
            <div class="main-content">
                <!-- M·ª§C 1: ƒê√É S·ª¨A TI√äU ƒê·ªÄ -->
                <div class="step-card">
                    <h2><i class="fa-solid fa-camera-retro"></i> AI gi√∫p b·∫°n ƒë·ªçc n·ªôi dung c·ªßa ·∫£nh ch·ª•p</h2>
                    <p>Nh·∫•n n√∫t d∆∞·ªõi ƒë·ªÉ sao ch√©p c√¢u l·ªánh "m·ªìi". Sau ƒë√≥, v√†o trang AI, <strong>t·∫£i ·∫£nh l√™n</strong> v√† d√°n c√¢u l·ªánh n√†y v√†o ƒë·ªÉ b·∫Øt ƒë·∫ßu.</p>
                    <button class="btn btn-secondary" id="generate-identify-prompt-btn" style="width: 100%; font-size: 1.2em; padding: 15px;">
                        <i class="fas fa-robot"></i> L·∫•y l·ªánh ƒë·ªçc ·∫£nh & M·ªü AI
                    </button>
                </div>
                <!-- M·ª§C 2: M·ª§C M·ªöI ƒê∆Ø·ª¢C TH√äM V√ÄO -->
                <div class="step-card">
                    <h2><i class="fa-brands fa-youtube" style="color: var(--youtube-color);"></i> T√≥m t·∫Øt n·ªôi dung Video tr√™n YouTube</h2>
                    <p>Sao ch√©p c√¢u l·ªánh chuy√™n s√¢u ƒë·ªÉ ph√¢n t√≠ch video YouTube v√† g·ª≠i ƒë·∫øn AI. D√°n l·ªánh n√†y c√πng v·ªõi link video b·∫°n mu·ªën t√≥m t·∫Øt.</p>
                    <button class="btn btn-youtube" id="generate-youtube-summary-btn" style="width: 100%; font-size: 1.2em; padding: 15px;">
                        <i class="fas fa-file-video"></i> L·∫•y l·ªánh t√≥m t·∫Øt Video
                    </button>
                </div>
                <!-- M·ª§C 3: Th∆∞ vi·ªán Prompt -->
                <div class="step-card">
                    <h2><i class="fa-solid fa-book-atlas"></i> Th∆∞ vi·ªán Prompt</h2>
                    <p>T·∫°o, l∆∞u tr·ªØ v√† qu·∫£n l√Ω c√°c c√¢u l·ªánh (prompt) y√™u th√≠ch c·ªßa b·∫°n ƒë·ªÉ s·ª≠ d·ª•ng l·∫°i b·∫•t c·ª© l√∫c n√†o.</p>
                    <button class="btn btn-accent" id="open-prompt-manager-btn" style="width: 100%; font-size: 1.2em; padding: 15px;">
                        <i class="fas fa-folder-open"></i> M·ªü Tr√¨nh qu·∫£n l√Ω Prompt
                    </button>
                </div>
            </div>
            <div class="sidebar">
                <div class="widget-card">
                    <h2><i class="fas fa-book-bookmark"></i> S·ªï tay b√†i h·ªçc</h2>
                    <p>Sau khi h·ªçc xong, h√£y l∆∞u l·∫°i nh·ªØng ki·∫øn th·ª©c hay v√†o ƒë√¢y nh√©.</p>
                    <button class="btn btn-accent" id="create-new-log-btn" style="width: 100%;"><i class="fas fa-plus"></i> T·∫°o b√†i h·ªçc m·ªõi</button>
                    <ul id="learning-log-list"></ul>
                </div>
            </div>
        </div>
    </div>

    <!-- === C√ÅC MODAL (C·ª¨A S·ªî POP-UP) === -->

    <!-- MODAL 1: S·ªî TAY B√ÄI H·ªåC -->
    <div class="modal-overlay" id="log-modal">
        <div class="modal-container" style="max-width: 700px;">
             <div class="modal-header">
                <h2 id="log-modal-title">T·∫°o b√†i h·ªçc m·ªõi</h2>
                <button class="modal-close-btn" id="log-modal-close-btn">&times;</button>
            </div>
            <div class="modal-body">
                <input type="text" id="log-title-input" class="log-input" placeholder="Ti√™u ƒë·ªÅ b√†i h·ªçc...">
                <textarea id="log-content-input" class="log-input" rows="10" placeholder="Ghi ch√∫ n·ªôi dung ƒë√£ h·ªçc..."></textarea>
            </div>
            <div style="text-align: right; padding-top: 15px; border-top: 1px solid #eee;">
                 <button class="btn btn-secondary" id="save-log-btn"><i class="fas fa-save"></i> L∆∞u b√†i h·ªçc</button>
            </div>
        </div>
    </div>

    <!-- MODAL 2: TR√åNH QU·∫¢N L√ù PROMPT -->
    <div class="modal-overlay" id="prompt-manager-modal">
        <div class="modal-container">
            <div class="modal-header">
                <h2 class="text-2xl font-bold text-indigo-600">üìö Qu·∫£n l√Ω Prompt C√° Nh√¢n</h2>
                <button class="modal-close-btn" id="close-prompt-manager-btn">&times;</button>
            </div>
            <div id="modal-content-wrapper">
                <!-- To√†n b·ªô giao di·ªán c·ªßa Tr√¨nh qu·∫£n l√Ω Prompt -->
                <div class="bg-white rounded-lg">
                    <!-- Khu v·ª±c nh·∫≠p li·ªáu -->
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                      <div class="flex items-center gap-2">
                        <input id="title" type="text" placeholder="Ti√™u ƒë·ªÅ" class="border rounded p-2 w-full" />
                        <button id="mic-title" class="mic-button text-gray-600 hover:text-indigo-500" title="Nh·∫≠p ti√™u ƒë·ªÅ b·∫±ng gi·ªçng n√≥i">üé§</button>
                      </div>
                      <div class="flex items-center gap-2 md:col-span-2">
                        <input id="content" type="text" placeholder="N·ªôi dung prompt ho·∫∑c URL" class="border rounded p-2 w-full" />
                        <button id="mic-content" class="mic-button text-gray-600 hover:text-indigo-500" title="Nh·∫≠p n·ªôi dung b·∫±ng gi·ªçng n√≥i">üé§</button>
                      </div>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                      <div class="flex items-center gap-2">
                        <input id="category" type="text" placeholder="Danh m·ª•c (VD: To√°n, VƒÉn...)" class="border rounded p-2 w-full" />
                        <button id="mic-category" class="mic-button text-gray-600 hover:text-indigo-500" title="Nh·∫≠p danh m·ª•c b·∫±ng gi·ªçng n√≥i">üé§</button>
                      </div>
                    </div>
                    <!-- C√°c n√∫t ch·ª©c nƒÉng ch√≠nh -->
                    <div class="flex flex-wrap gap-2 mb-4">
                      <button onclick="addPrompt()" class="bg-indigo-500 hover:bg-indigo-600 text-white px-4 py-2 rounded">‚ûï Th√™m Prompt</button>
                      <button onclick="exportPrompts()" class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded">‚¨áÔ∏è Xu·∫•t JSON</button>
                      <input type="file" id="importFile" class="hidden" onchange="importPrompts(event)" />
                      <button onclick="document.getElementById('importFile').click()" class="bg-yellow-500 hover:bg-yellow-600 text-white px-4 py-2 rounded">‚¨ÜÔ∏è Nh·∫≠p Prompt</button>
                      <input id="deleteCategoryInput" type="text" placeholder="Nh·∫≠p danh m·ª•c c·∫ßn xo√°" class="border rounded p-2" />
                      <button onclick="deleteCategory()" class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded">üóëÔ∏è Xo√° danh m·ª•c</button>
                    </div>
                    <!-- B·ªô l·ªçc v√† t√¨m ki·∫øm -->
                    <div class="mb-4 flex items-center gap-4">
                      <label class="font-medium">Ch·∫ø ƒë·ªô hi·ªÉn th·ªã:</label>
                      <select id="viewMode" onchange="renderPrompts()" class="border rounded p-2">
                        <option value="grouped" selected>Theo nh√≥m danh m·ª•c</option>
                        <option value="all">T·∫•t c·∫£ prompt</option>
                      </select>
                    </div>
                    <div id="categoryFilterWrap" class="mb-4" style="display: block;">
                      <label for="categoryFilter" class="font-medium mr-2">Ch·ªçn danh m·ª•c:</label>
                      <select id="categoryFilter" onchange="renderPrompts()" class="border rounded p-2">
                        <option value="all">T·∫•t c·∫£</option>
                      </select>
                    </div>
                    <input id="search" oninput="renderPrompts()" type="text" placeholder="üîç T√¨m theo ti√™u ƒë·ªÅ ho·∫∑c n·ªôi dung..." class="w-full border rounded p-2 mb-4" />
                    <div id="voice-status"></div>
                    <!-- N∆°i hi·ªÉn th·ªã danh s√°ch prompt -->
                    <div id="promptList" class="space-y-6"></div>
                    <div id="pagination" class="mt-6 flex justify-center gap-2"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- === TO√ÄN B·ªò JAVASCRIPT C·ª¶A TRANG === -->
    <script>
        // --- PH·∫¶N 1: LOGIC C·ª¶A TRANG CH√çNH "H·ªåC C√ôNG AI" ---

        const generateIdentifyBtn = document.getElementById('generate-identify-prompt-btn');
        const generateYoutubeSummaryBtn = document.getElementById('generate-youtube-summary-btn');
        const openPromptManagerBtn = document.getElementById('open-prompt-manager-btn');
        const promptManagerModal = document.getElementById('prompt-manager-modal');
        const closePromptManagerBtn = document.getElementById('close-prompt-manager-btn');
        
        // C√¢u l·ªánh "m·ªìi" ƒë·ªÉ ƒë·ªçc ·∫£nh
        const imageReaderPrompt = `H√£y ch√©p l·∫°i n·ªôi dung c·ªßa b·ª©c ·∫£nh m√† t√¥i upload l√™n ·ªü ƒë√¢y. Sau ƒë√≥ b·∫°n h√£y l√† m·ªôt gia s∆∞ ( tr√¨nh ƒë·ªô si√™u ƒë·∫≥ng, lu√¥n lu√¥n gi·∫£ng b√†i k√®m ·∫©n d·ª• d·ªÖ hi·ªÉu ) t·∫•t c·∫£ c√°c m√¥n h·ªçc , b·∫°n r·∫•t vui t√≠nh v√† am hi·ªÉu h·ªçc sinh ti·ªÉu h·ªçc, trung h·ªçc c∆° s·ªü v√† c·∫£ ƒë·∫°i h·ªçc v√† h·ªèi t√¥i xem t√¥i mu·ªën gi·∫£i b√†i gi√∫p hay l√†m nh·ªØng g√¨ t·ª´ b·ª©c ·∫£nh n√†y.`;

        // C√¢u l·ªánh "si√™u c·∫•p" ƒë·ªÉ t√≥m t·∫Øt video YouTube
        const youtubeSummaryPrompt = `H√£y t√≥m t·∫Øt n·ªôi dung video c·ªßa youtube m√† t√¥i upload l√™n ·ªü ƒë√¢y ho·∫∑c ƒë∆∞a link d∆∞·ªõi ƒë√¢y  theo nh·ªØng y√™u c·∫ßu chi ti·∫øt nh∆∞ sau:

# System Prompt: Ph√¢n t√≠ch Video YouTube
## Vai tr√≤
B·∫°n l√† m·ªôt chuy√™n gia ph√¢n t√≠ch v√† t√≥m t·∫Øt n·ªôi dung video, chuy√™n v·ªÅ vi·ªác tr√≠ch xu·∫•t th√¥ng tin quan tr·ªçng t·ª´ c√°c video YouTube v√† tr√¨nh b√†y m·ªôt c√°ch c√≥ c·∫•u tr√∫c, d·ªÖ hi·ªÉu.

## Nhi·ªám v·ª• ch√≠nh
Khi nh·∫≠n ƒë∆∞·ª£c ƒë∆∞·ªùng link YouTube, b·∫°n c·∫ßn t·∫°o ra b·∫£n t√≥m t·∫Øt (summary) theo c·∫•u tr√∫c b·ªën ph·∫ßn b·∫Øt bu·ªôc d∆∞·ªõi ƒë√¢y:

### PH·∫¶N 1: T·ªîNG QUAN V√Ä INSIGHT C·ªêT L√ïI
- Tr√¨nh b√†y √Ω t∆∞·ªüng ch√≠nh (main idea) v√† th√¥ng ƒëi·ªáp c·ªët l√µi (core message) c·ªßa video
- X√°c ƒë·ªãnh m·ª•c ƒë√≠ch (purpose) v√† ƒë·ªëi t∆∞·ª£ng m·ª•c ti√™u (target audience) 
- ƒê∆∞a ra ƒë√°nh gi√° v·ªÅ gi√° tr·ªã th√¥ng tin (information value) v√† t√≠nh ·ª©ng d·ª•ng (applicability)
- N√™u insight quan tr·ªçng nh·∫•t m√† ng∆∞·ªùi xem c√≥ th·ªÉ thu ƒë∆∞·ª£c

**C√ÇY TH∆Ø M·ª§C N·ªòI DUNG (Content Directory Tree):**
- **B·∫ÆT BU·ªòC s·ª≠ d·ª•ng k√Ω t·ª± c√¢y th∆∞ m·ª•c**: \`‚îú‚îÄ‚îÄ\` cho c√°c nh√°nh con, \`‚îî‚îÄ‚îÄ\` cho nh√°nh cu·ªëi c√πng
- T·∫°o c·∫•u tr√∫c c√¢y th∆∞ m·ª•c d·∫°ng **overview structure** theo format: \`[time start] - [time end] : [ti√™u ƒë·ªÅ ƒë·∫ßu m·ª•c ch√≠nh]\`
- **Ch·ªâ li·ªát k√™ c√°c ƒë·∫ßu m·ª•c ch√≠nh** (main topics), kh√¥ng vi·∫øt chi ti·∫øt n·ªôi dung
- S·ª≠ d·ª•ng indentation (th·ª•t l·ªÅ) v·ªõi k√Ω t·ª± tree ƒë·ªÉ th·ªÉ hi·ªán sub-topics level 1
- **M·ª•c ƒë√≠ch**: T·∫°o roadmap t·ªïng th·ªÉ cho ng∆∞·ªùi ƒë·ªçc nhanh ch√≥ng n·∫Øm b·∫Øt c·∫•u tr√∫c video
- **Ng·∫Øn g·ªçn**: M·ªói ƒë·∫ßu m·ª•c ch·ªâ 1 d√≤ng, t·ªëi ƒëa 10-15 t·ª´
- **ƒê·ªãnh d·∫°ng b·∫Øt bu·ªôc**: Ph·∫£i c√≥ √≠t nh·∫•t 1 main topic c√≥ sub-topics ƒë·ªÉ th·ªÉ hi·ªán c√¢y th∆∞ m·ª•c th·∫≠t s·ª±

### PH·∫¶N 2: T√ìM T·∫ÆT THEO TIMELINE (Chi ti·∫øt n·ªôi dung)
- **ƒê√°nh s·ªë th·ª© t·ª±**: S·ª≠ d·ª•ng numbering kh·ªõp v·ªõi c√¢y th∆∞ m·ª•c ·ªü Ph·∫ßn 1 (1, 2, 3...)
- **M·ª•c ƒë√≠ch**: Ph√¢n t√≠ch chi ti·∫øt n·ªôi dung t·ª´ng segment ƒë√£ outline trong c√¢y th∆∞ m·ª•c
- **∆Øu ti√™n cao**: Tr√≠ch xu·∫•t c√°c n·ªôi dung mang t√≠nh c√° nh√¢n h√≥a (personalized content):
  - Kinh nghi·ªám c√° nh√¢n (personal experience) c·ªßa ng∆∞·ªùi n√≥i
  - Quan ƒëi·ªÉm ch·ªß quan (subjective viewpoint) v√† ƒë√°nh gi√° c√° nh√¢n
  - C√¢u chuy·ªán th·ª±c t·∫ø (real-life stories) v√† v√≠ d·ª• c·ª• th·ªÉ
  - L·ªùi khuy√™n d·ª±a tr√™n tr·∫£i nghi·ªám (experience-based advice)
  - Ph·∫£n √°nh v√† suy ng·∫´m c√° nh√¢n (personal reflection)
- Ghi ch√∫ c√°c th·ªùi ƒëi·ªÉm quan tr·ªçng (key moments) v√† transition points
- ƒê√°nh d·∫•u nh·ªØng ph·∫ßn c√≥ t√≠nh t∆∞∆°ng t√°c (interactive elements) v·ªõi kh√°n gi·∫£
- **Format**: \`[S·ªë th·ª© t·ª±]. [Timestamp] - [Ti√™u ƒë·ªÅ segment]: [Detailed content analysis]\`

### PH·∫¶N 3: ƒêI·ªÄU CH·ªàNH ƒê·ªò D√ÄI THEO T√çNH CH·∫§T CONTENT
**Ti√™u ch√≠ ph√¢n lo·∫°i:**

#### Video h·ªçc thu·∫≠t/gi√°o d·ª•c (Academic/Educational):
- **ƒê·∫∑c ƒëi·ªÉm**: C√≥ c·∫•u tr√∫c logic, n·ªôi dung chuy√™n m√¥n, d·ªØ li·ªáu c·ª• th·ªÉ
- **ƒê·ªô d√†i t√≥m t·∫Øt**: Chi ti·∫øt, 800-1500 t·ª´
- **Y√™u c·∫ßu**: Bao g·ªìm methodology, data points, conclusions, references
- **Focus**: Ki·∫øn th·ª©c chuy√™n m√¥n, research findings, theoretical frameworks

#### Video gi·∫£i tr√≠/lifestyle (Entertainment/Lifestyle):
- **ƒê·∫∑c ƒëi·ªÉm**: N·ªôi dung nh·∫π nh√†ng, chia s·∫ª tr·∫£i nghi·ªám, storytelling
- **ƒê·ªô d√†i t√≥m t·∫Øt**: Ng·∫Øn g·ªçn, 300-600 t·ª´  
- **Y√™u c·∫ßu**: Highlights ch√≠nh, memorable moments, key takeaways
- **Focus**: Entertainment value, personal stories, practical tips

### **PH·∫¶N 4: KEY TAKEAWAYS**

**N·ªôi dung b·∫Øt bu·ªôc ph·∫£i bao g·ªìm:**
- **√çt nh·∫•t 3-5 ƒëi·ªÉm ch√≠nh** ƒë∆∞·ª£c tr√≠ch xu·∫•t t·ª´ video
- **Actionable insights** - nh·ªØng g√¨ ng∆∞·ªùi xem c√≥ th·ªÉ √°p d·ª•ng ngay
- **Memorable quotes** - tr√≠ch d·∫´n nh·ªØng c√¢u n√≥i ·∫•n t∆∞·ª£ng nh·∫•t
- **Practical applications** - ·ª©ng d·ª•ng th·ª±c t·∫ø c·ªßa ki·∫øn th·ª©c
- **Personal reflections** - suy ng·∫´m v√† ƒë√°nh gi√° v·ªÅ n·ªôi dung
- **Value proposition** - gi√° tr·ªã c·ªët l√µi m√† video mang l·∫°i

**Format b·∫Øt bu·ªôc:**
\`\`\`
## üí° KEY TAKEAWAYS

‚úÖ **[Takeaway 1]**: [M√¥ t·∫£ chi ti·∫øt v√† ·ª©ng d·ª•ng th·ª±c t·∫ø]
‚úÖ **[Takeaway 2]**: [M√¥ t·∫£ chi ti·∫øt v√† ·ª©ng d·ª•ng th·ª±c t·∫ø]
‚úÖ **[Takeaway 3]**: [M√¥ t·∫£ chi ti·∫øt v√† ·ª©ng d·ª•ng th·ª±c t·∫ø]
üìù **Quote ƒë√°ng nh·ªõ**: "[Tr√≠ch d·∫´n tr·ª±c ti·∫øp t·ª´ video]"
üéØ **H√†nh ƒë·ªông c·ª• th·ªÉ**: [Nh·ªØng vi·ªác ng∆∞·ªùi xem n√™n l√†m sau khi xem video]
\`\`\`
## Quy t·∫Øc v√† nguy√™n t·∫Øc
### Nguy√™n t·∫Øc vi·∫øt:
- S·ª≠ d·ª•ng ng√¥n ng·ªØ r√µ r√†ng, d·ªÖ hi·ªÉu
- Gi·ªØ t√≠nh kh√°ch quan (objectivity) nh∆∞ng kh√¥ng b·ªè qua c√°c y·∫øu t·ªë subjective
- Tr√≠ch d·∫´n tr·ª±c ti·∫øp (direct quotes) c√°c ph√°t ng√¥n quan tr·ªçng
- S·ª≠ d·ª•ng bullet points cho c√°c danh s√°ch v√† timeline
- **NGHI√äM C·∫§M**: B·ªè qua ph·∫ßn KEY TAKEAWAYS - ƒë√¢y l√† requirement b·∫Øt bu·ªôc

### Y√™u c·∫ßu k·ªπ thu·∫≠t:
- Lu√¥n b·∫Øt ƒë·∫ßu b·∫±ng x√°c ƒë·ªãnh lo·∫°i video (content type classification)
- Ghi r√µ th·ªùi l∆∞·ª£ng video (duration) v√† ng√†y ƒëƒÉng (upload date)
- **QUAN TR·ªåNG**: Trong c√¢y th∆∞ m·ª•c, B·∫ÆT BU·ªòC s·ª≠ d·ª•ng k√Ω t·ª± \`‚îú‚îÄ‚îÄ\` v√† \`‚îî‚îÄ‚îÄ\` ƒë·ªÉ t·∫°o tree structure th·∫≠t s·ª±
- C√¢y th∆∞ m·ª•c ph·∫£i c√≥ √≠t nh·∫•t 1 main topic ch·ª©a sub-topics ƒë·ªÉ th·ªÉ hi·ªán c·∫•u tr√∫c ph√¢n c·∫•p
- Ki·ªÉm tra t√≠nh ch√≠nh x√°c (accuracy) c·ªßa th√¥ng tin tr∆∞·ªõc khi t√≥m t·∫Øt
- ƒê√°nh gi√° credibility c·ªßa ngu·ªìn th√¥ng tin
- **B·∫ÆT BU·ªòC**: Ph·∫£i ho√†n th√†nh ƒë·∫ßy ƒë·ªß ph·∫ßn KEY TAKEAWAYS v·ªõi minimum 3 takeaways

### L∆∞u √Ω ƒë·∫∑c bi·ªát:
- **FORMAT C√ÇY TH∆Ø M·ª§C**: Lu√¥n lu√¥n s·ª≠ d·ª•ng k√Ω t·ª± \`‚îú‚îÄ‚îÄ\` cho sub-topics ·ªü gi·ªØa v√† \`‚îî‚îÄ‚îÄ\` cho sub-topic cu·ªëi c√πng
- **V√ç D·ª§ ƒê√öNG**:
  \`\`\`
  2. [05:31] - [15:45] : Ch·ªß ƒë·ªÅ ch√≠nh
     ‚îú‚îÄ‚îÄ [07:20] - [09:10] : Sub-topic 1  
     ‚îú‚îÄ‚îÄ [09:11] - [12:45] : Sub-topic 2
     ‚îî‚îÄ‚îÄ [12:46] - [15:45] : Sub-topic 3
  \`\`\`
- **V√ç D·ª§ SAI**: Ch·ªâ li·ªát k√™ ƒë∆°n thu·∫ßn m√† kh√¥ng c√≥ k√Ω t·ª± c√¢y
- Tr√°nh bias c√° nh√¢n trong qu√° tr√¨nh t√≥m t·∫Øt
- Kh√¥ng b·ªè s√≥t information gaps ho·∫∑c contradictions trong video
- Highlight c√°c actionable insights m√† ng∆∞·ªùi xem c√≥ th·ªÉ √°p d·ª•ng ngay
- ƒê·ªÅ xu·∫•t related topics ho·∫∑c follow-up questions n·∫øu ph√π h·ª£p
- **CRITICAL**: N·∫øu thi·∫øu ph·∫ßn KEY TAKEAWAYS, coi nh∆∞ ho√†n th√†nh kh√¥ng ƒë·∫°t y√™u c·∫ßu

## Ki·ªÉm tra ch·∫•t l∆∞·ª£ng ƒë·∫ßu ra (Quality Check)

**Tr∆∞·ªõc khi ho√†n th√†nh response, b·∫Øt bu·ªôc ph·∫£i ki·ªÉm tra:**
‚òëÔ∏è C√≥ ƒë·∫ßy ƒë·ªß 4 ph·∫ßn ch√≠nh: T·ªïng quan, Timeline, N·ªôi dung chi ti·∫øt, KEY TAKEAWAYS
‚òëÔ∏è C√¢y th∆∞ m·ª•c s·ª≠ d·ª•ng ƒë√∫ng k√Ω t·ª± \`‚îú‚îÄ‚îÄ\` v√† \`‚îî‚îÄ‚îÄ\`
‚òëÔ∏è Ph·∫ßn KEY TAKEAWAYS c√≥ √≠t nh·∫•t 3 ƒëi·ªÉm ch√≠nh
‚òëÔ∏è C√≥ tr√≠ch d·∫´n quote ƒë√°ng nh·ªõ
‚òëÔ∏è C√≥ h√†nh ƒë·ªông c·ª• th·ªÉ cho ng∆∞·ªùi xem
‚òëÔ∏è Format ƒë√∫ng theo template ƒë∆∞·ª£c ch·ªâ ƒë·ªãnh
## Format ƒë·∫ßu ra chu·∫©n:
\`\`\`
üé• **[TI√äU ƒê·ªÄ VIDEO]**
üìÖ Th·ªùi l∆∞·ª£ng: [X ph√∫t] | ƒêƒÉng ng√†y: [DD/MM/YYYY]
üéØ Lo·∫°i content: [Academic/Educational/Entertainment/Lifestyle]
---

## üîç T·ªîNG QUAN & INSIGHT C·ªêT L√ïI
[N·ªôi dung t·ªïng quan]
### üìã C√ÇY TH∆Ø M·ª§C N·ªòI DUNG:
\`\`\`
1. [00:00] - [05:30] : M·ªü ƒë·∫ßu v√† gi·ªõi thi·ªáu ch·ªß ƒë·ªÅ
2. [05:31] - [15:45] : Ph√¢n t√≠ch v·∫•n ƒë·ªÅ ch√≠nh
   ‚îú‚îÄ‚îÄ [07:20] - [09:10] : Nguy√™n nh√¢n
   ‚îú‚îÄ‚îÄ [09:11] - [12:45] : H·∫≠u qu·∫£  
   ‚îî‚îÄ‚îÄ [12:46] - [15:45] : T√°c ƒë·ªông
3. [15:46] - [25:20] : ƒê∆∞a ra gi·∫£i ph√°p
   ‚îú‚îÄ‚îÄ [16:00] - [20:30] : Gi·∫£i ph√°p ng·∫Øn h·∫°n
   ‚îî‚îÄ‚îÄ [20:31] - [25:20] : Gi·∫£i ph√°p d√†i h·∫°n
4. [25:21] - [30:00] : K·∫øt lu·∫≠n v√† h√†nh ƒë·ªông
\`\`\`
---
## ‚è±Ô∏è T√ìM T·∫ÆT THEO TIMELINE

**1. [00:00-05:30] - M·ªü ƒë·∫ßu v√† gi·ªõi thi·ªáu ch·ªß ƒë·ªÅ:**
[Chi ti·∫øt ph√¢n t√≠ch n·ªôi dung, tr√≠ch d·∫´n quote, personal insights, experience c√° nh√¢n...]

**2. [05:31-12:45] - Ph√¢n t√≠ch v·∫•n ƒë·ªÅ ch√≠nh:**
[Chi ti·∫øt n·ªôi dung v·ªõi focus v√†o c√° nh√¢n h√≥a, c√¢u chuy·ªán th·ª±c t·∫ø, ƒë√°nh gi√° ch·ªß quan...]
  - **2.1 [07:20-09:10] - Nguy√™n nh√¢n:** [Chi ti·∫øt ph√¢n t√≠ch sub-topic]
  - **2.2 [09:11-12:45] - H·∫≠u qu·∫£:** [Chi ti·∫øt ph√¢n t√≠ch sub-topic]

**3. [12:46-18:20] - ƒê∆∞a ra gi·∫£i ph√°p:**
[Chi ti·∫øt n·ªôi dung, actionable insights, l·ªùi khuy√™n d·ª±a tr√™n kinh nghi·ªám...]

**4. [18:21-22:00] - K·∫øt lu·∫≠n v√† h√†nh ƒë·ªông:**
[Chi ti·∫øt n·ªôi dung, call-to-action, key takeaways...]
---

## üí° KEY TAKEAWAYS **[B·∫ÆT BU·ªòC - KH√îNG ƒê∆Ø·ª¢C B·ªé QUA]**

‚úÖ **[Takeaway 1]**: [M√¥ t·∫£ chi ti·∫øt v√† ·ª©ng d·ª•ng th·ª±c t·∫ø]
‚úÖ **[Takeaway 2]**: [M√¥ t·∫£ chi ti·∫øt v√† ·ª©ng d·ª•ng th·ª±c t·∫ø]
‚úÖ **[Takeaway 3]**: [M√¥ t·∫£ chi ti·∫øt v√† ·ª©ng d·ª•ng th·ª±c t·∫ø]
üìù **Quote ƒë√°ng nh·ªõ**: "[Tr√≠ch d·∫´n tr·ª±c ti·∫øp t·ª´ video]"
üéØ **H√†nh ƒë·ªông c·ª• th·ªÉ**: [Nh·ªØng vi·ªác ng∆∞·ªùi xem n√™n l√†m sau khi xem video]
---
## üîó RELATED SUGGESTIONS
[ƒê·ªÅ xu·∫•t ch·ªß ƒë·ªÅ li√™n quan n·∫øu c√≥]
\`\`\`
H√£y lu√¥n ƒë·∫£m b·∫£o b·∫£n t√≥m t·∫Øt cung c·∫•p gi√° tr·ªã th·ª±c s·ª± cho ng∆∞·ªùi ƒë·ªçc v√† gi√∫p h·ªç ti·∫øt ki·ªám th·ªùi gian while maintaining the essence c·ªßa video g·ªëc.
`;
        
        // H√†m tr·ª£ gi√∫p ƒë·ªÉ m·ªü AI
        async function sendPromptToAI(promptText) {
            try {
                await navigator.clipboard.writeText(promptText);
                alert('‚úÖ ƒê√£ sao ch√©p c√¢u l·ªánh! Chu·∫©n b·ªã chuy·ªÉn ƒë·∫øn trang AI...');
                window.open('https://aistudio.google.com/u/2/prompts/new_chat', '_blank');
            } catch (err) {
                console.error('L·ªói sao ch√©p:', err);
                alert('‚ùå Kh√¥ng th·ªÉ t·ª± ƒë·ªông sao ch√©p c√¢u l·ªánh.');
            }
        }
        
        generateIdentifyBtn.addEventListener('click', () => sendPromptToAI(imageReaderPrompt));
        generateYoutubeSummaryBtn.addEventListener('click', () => sendPromptToAI(youtubeSummaryPrompt));
        openPromptManagerBtn.addEventListener('click', () => { promptManagerModal.style.display = 'flex'; });
        closePromptManagerBtn.addEventListener('click', () => { promptManagerModal.style.display = 'none'; });

        // --- PH·∫¶N 2: LOGIC C·ª¶A S·ªî TAY B√ÄI H·ªåC ---

        const createNewLogBtn = document.getElementById('create-new-log-btn');
        const learningLogList = document.getElementById('learning-log-list');
        const logModal = document.getElementById('log-modal');
        const logModalCloseBtn = document.getElementById('log-modal-close-btn');
        const logModalTitle = document.getElementById('log-modal-title');
        const logTitleInput = document.getElementById('log-title-input');
        const logContentInput = document.getElementById('log-content-input');
        const saveLogBtn = document.getElementById('save-log-btn');
        
        let logs = JSON.parse(localStorage.getItem('learningLogs')) || [
            { id: 1, title: "C√°ch gi·∫£i ph∆∞∆°ng tr√¨nh b·∫≠c hai", content: "ƒê·ªÉ gi·∫£i ph∆∞∆°ng tr√¨nh ax^2 + bx + c = 0, ta t√≠nh delta = b^2 - 4ac.\n- N·∫øu delta > 0, c√≥ 2 nghi·ªám ph√¢n bi·ªát.\n- N·∫øu delta = 0, c√≥ nghi·ªám k√©p.\n- N·∫øu delta < 0, ph∆∞∆°ng tr√¨nh v√¥ nghi·ªám."}
        ];
        let currentEditingLogId = null;

        function saveLogs() { localStorage.setItem('learningLogs', JSON.stringify(logs)); }
        function renderLogs() {
            learningLogList.innerHTML = '';
            if (logs.length === 0) {
                learningLogList.innerHTML = `<p style="text-align:center; color: #888; margin-top:20px;">Ch∆∞a c√≥ b√†i h·ªçc n√†o.</p>`;
                return;
            }
            logs.forEach(log => {
                const li = document.createElement('li');
                li.innerHTML = `
                    <span class="log-title">${log.title}</span>
                    <div class="log-actions">
                        <button class="edit-log-btn" data-id="${log.id}" title="S·ª≠a"><i class="fas fa-pencil-alt"></i></button>
                        <button class="delete-log-btn" data-id="${log.id}" title="X√≥a"><i class="fas fa-trash-alt"></i></button>
                    </div>
                `;
                learningLogList.appendChild(li);
            });
        }
        function openLogModalForNew() {
            currentEditingLogId = null;
            logModalTitle.textContent = 'T·∫°o b√†i h·ªçc m·ªõi';
            logTitleInput.value = '';
            logContentInput.value = '';
            logModal.style.display = 'flex';
        }
        function openLogModalForEdit(id) {
            const logToEdit = logs.find(log => log.id === id);
            if (logToEdit) {
                currentEditingLogId = id;
                logModalTitle.textContent = 'S·ª≠a b√†i h·ªçc';
                logTitleInput.value = logToEdit.title;
                logContentInput.value = logToEdit.content;
                logModal.style.display = 'flex';
            }
        }
        function deleteLog(id) {
            if (confirm('B·∫°n c√≥ ch·∫Øc mu·ªën xo√° b√†i h·ªçc n√†y kh√¥ng?')) {
                logs = logs.filter(log => log.id !== id);
                saveLogs();
                renderLogs();
            }
        }

        createNewLogBtn.addEventListener('click', openLogModalForNew);
        logModalCloseBtn.addEventListener('click', () => { logModal.style.display = 'none'; });
        saveLogBtn.addEventListener('click', () => {
            const title = logTitleInput.value.trim();
            const content = logContentInput.value.trim();
            if (!title) { alert('Vui l√≤ng nh·∫≠p ti√™u ƒë·ªÅ cho b√†i h·ªçc!'); return; }
            if (currentEditingLogId) {
                const logToUpdate = logs.find(log => log.id === currentEditingLogId);
                logToUpdate.title = title;
                logToUpdate.content = content;
            } else {
                logs.push({ id: Date.now(), title, content });
            }
            saveLogs();
            renderLogs();
            logModal.style.display = 'none';
        });
        learningLogList.addEventListener('click', (e) => {
            const editBtn = e.target.closest('.edit-log-btn');
            if (editBtn) openLogModalForEdit(Number(editBtn.dataset.id));
            const deleteBtn = e.target.closest('.delete-log-btn');
            if (deleteBtn) deleteLog(Number(deleteBtn.dataset.id));
        });

        // --- PH·∫¶N 3: LOGIC C·ª¶A TR√åNH QU·∫¢N L√ù PROMPT ---
        
        let editingIndex = -1;
        const itemsPerPage = 5;
        let currentPage = 1;
        let recognition;
        let isRecording = false;
        let currentMicTarget = null;
        
        const initialPrompts = [
          { title: "Gi·∫£i th√≠ch kh√°i ni·ªám To√°n", content: "B·∫°n l√† gia s∆∞ si√™u ƒë·∫≥ng. H√£y gi·∫£i th√≠ch kh√°i ni·ªám [ƒêi·ªÅn kh√°i ni·ªám, VD: 'ph√¢n s·ªë'] m·ªôt c√°ch th·∫≠t d·ªÖ hi·ªÉu, s·ª≠ d·ª•ng c√°c v√≠ d·ª• v√† ·∫©n d·ª• g·∫ßn g≈©i v·ªõi h·ªçc sinh l·ªõp [ƒêi·ªÅn l·ªõp, VD: 6].", category: "To√°n h·ªçc" },
          { title: "Ph√¢n t√≠ch t√°c ph·∫©m VƒÉn h·ªçc", content: "H√£y ph√¢n t√≠ch h√¨nh t∆∞·ª£ng nh√¢n v·∫≠t [T√™n nh√¢n v·∫≠t] trong t√°c ph·∫©m [T√™n t√°c ph·∫©m]. T·∫≠p trung v√†o c√°c chi ti·∫øt v·ªÅ ngo·∫°i h√¨nh, h√†nh ƒë·ªông, n·ªôi t√¢m v√† m·ªëi quan h·ªá v·ªõi c√°c nh√¢n v·∫≠t kh√°c.", category: "Ng·ªØ vƒÉn" },
          { title: "L·∫≠p d√†n √Ω b√†i vƒÉn Ngh·ªã lu·∫≠n", content: "L·∫≠p m·ªôt d√†n √Ω chi ti·∫øt cho b√†i vƒÉn ngh·ªã lu·∫≠n v·ªÅ v·∫•n ƒë·ªÅ: [ƒêi·ªÅn ch·ªß ƒë·ªÅ, VD: 'T·∫ßm quan tr·ªçng c·ªßa vi·ªác ƒë·ªçc s√°ch']. D√†n √Ω c·∫ßn c√≥ ƒë·ªß M·ªü b√†i, Th√¢n b√†i (v·ªõi √≠t nh·∫•t 3 lu·∫≠n ƒëi·ªÉm), v√† K·∫øt b√†i.", category: "Ng·ªØ vƒÉn" },
          { title: "T√≥m t·∫Øt s·ª± ki·ªán L·ªãch s·ª≠", content: "T√≥m t·∫Øt s·ª± ki·ªán l·ªãch s·ª≠ [T√™n s·ª± ki·ªán, VD: 'Chi·∫øn d·ªãch ƒêi·ªán Bi√™n Ph·ªß'] th√†nh 5 g·∫°ch ƒë·∫ßu d√≤ng ch√≠nh, bao g·ªìm: th·ªùi gian, b·ªëi c·∫£nh, di·ªÖn bi·∫øn ch√≠nh, k·∫øt qu·∫£ v√† √Ω nghƒ©a.", category: "L·ªãch s·ª≠" },
          { title: "Gi·∫£i th√≠ch hi·ªán t∆∞·ª£ng Khoa h·ªçc", content: "Gi·∫£i th√≠ch hi·ªán t∆∞·ª£ng [T√™n hi·ªán t∆∞·ª£ng, VD: 'Quang h·ª£p ·ªü th·ª±c v·∫≠t'] b·∫±ng ng√¥n ng·ªØ ƒë∆°n gi·∫£n. T·∫°i sao n√≥ l·∫°i x·∫£y ra v√† vai tr√≤ c·ªßa n√≥ ƒë·ªëi v·ªõi s·ª± s·ªëng l√† g√¨?", category: "Khoa h·ªçc" },
          { title: "H·ªçc t·ª´ v·ª±ng Ti·∫øng Anh", content: "T√¥i mu·ªën h·ªçc t·ª´ v·ª±ng ti·∫øng Anh v·ªÅ ch·ªß ƒë·ªÅ [ƒêi·ªÅn ch·ªß ƒë·ªÅ, VD: 'Du l·ªãch']. H√£y cho t√¥i 10 t·ª´ v·ª±ng quan tr·ªçng, k√®m theo lo·∫°i t·ª´, phi√™n √¢m, ƒë·ªãnh nghƒ©a v√† m·ªôt c√¢u v√≠ d·ª• cho m·ªói t·ª´.", category: "Ngo·∫°i ng·ªØ" }
        ];
        let prompts = JSON.parse(localStorage.getItem("prompts")) || initialPrompts;

        function setupSpeechRecognition() {
          const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
          const statusEl = document.getElementById('voice-status');
          if (!SpeechRecognition) {
            if (statusEl) statusEl.textContent = 'Tr√¨nh duy·ªát kh√¥ng h·ªó tr·ª£ nh·∫≠n di·ªán gi·ªçng n√≥i.';
            ['mic-title', 'mic-content', 'mic-category'].forEach(id => { const btn = document.getElementById(id); if (btn) btn.disabled = true; });
            return;
          }
          recognition = new SpeechRecognition();
          recognition.lang = 'vi-VN';
          recognition.continuous = false;
          recognition.interimResults = false;
          recognition.onstart = () => { isRecording = true; currentMicTarget.classList.add('recording'); statusEl.textContent = 'ƒêang ghi √¢m...'; };
          recognition.onend = () => { isRecording = false; currentMicTarget.classList.remove('recording'); if (statusEl.textContent === 'ƒêang ghi √¢m...') statusEl.textContent = ''; };
          recognition.onerror = (event) => { isRecording = false; currentMicTarget.classList.remove('recording'); statusEl.textContent = 'L·ªói: ' + event.error; };
          recognition.onresult = (event) => {
            const transcript = event.results[0][0].transcript.trim();
            const targetInputId = currentMicTarget.id.replace('mic-', '');
            document.getElementById(targetInputId).value = transcript;
            statusEl.textContent = `ƒê√£ nh·∫≠p: "${transcript}"`;
          };
        }
        function toggleMic(targetId) { if (!recognition) return; currentMicTarget = document.getElementById(targetId); isRecording ? recognition.stop() : recognition.start(); }
        function renderPrompts() {
          localStorage.setItem("prompts", JSON.stringify(prompts));
          const viewMode = document.getElementById('viewMode').value;
          const categoryFilterWrap = document.getElementById("categoryFilterWrap");
          categoryFilterWrap.style.display = viewMode === "grouped" ? "block" : "none";
          const search = document.getElementById("search").value.toLowerCase();
          const promptList = document.getElementById("promptList");
          const filtered = prompts.filter(p => p.title.toLowerCase().includes(search) || p.content.toLowerCase().includes(search));
          promptList.innerHTML = "";
          if (viewMode === "all") { renderAllPrompts(filtered); return; }
          renderGroupedPrompts(filtered);
        }
        function createPromptHTML(p, index) {
            const contentDisplay = p.url ? `<div class="mb-1"><a href="${p.url}" target="_blank" class="text-blue-500 hover:text-blue-700 hover:underline">üîó ${p.content}</a></div>` : `<div class="text-gray-700 whitespace-pre-wrap">${p.content}</div>`;
            return `<div class="border p-4 rounded shadow bg-gray-50 mb-3"><div class="mb-2"><strong class="text-gray-900">${p.title}</strong></div>${contentDisplay}<div class="flex flex-wrap gap-2 mt-2"><button onclick="askAI(${index})" class="bg-purple-500 hover:bg-purple-600 text-white px-2 py-1 text-sm rounded">ü§ñ Sao ch√©p & H·ªèi AI</button><button onclick="editPrompt(${index})" class="bg-yellow-400 hover:bg-yellow-500 text-white px-2 py-1 text-sm rounded">‚úèÔ∏è S·ª≠a</button><button onclick="deletePrompt(${index})" class="bg-red-400 hover:bg-red-500 text-white px-2 py-1 text-sm rounded">üóëÔ∏è Xo√°</button></div></div>`;
        }
        function renderAllPrompts(filteredPrompts) { const promptList = document.getElementById("promptList"); filteredPrompts.forEach(p => { const originalIndex = prompts.findIndex(item => item === p); promptList.innerHTML += createPromptHTML(p, originalIndex); }); renderPagination(1); }
        function renderGroupedPrompts(filteredPrompts) {
          const promptList = document.getElementById("promptList");
          const categoryFilter = document.getElementById("categoryFilter");
          const categories = {};
          filteredPrompts.forEach(p => { if (!categories[p.category]) categories[p.category] = []; categories[p.category].push(p); });
          const categoryKeys = Object.keys(categories).sort();
          const selectedCategory = categoryFilter.value;
          let filteredCategories = selectedCategory === "all" ? categoryKeys : categoryKeys.filter(cat => cat === selectedCategory);
          const totalPages = Math.ceil(filteredCategories.length / itemsPerPage);
          const start = (currentPage - 1) * itemsPerPage;
          const visibleCategories = filteredCategories.slice(start, start + itemsPerPage);
          promptList.innerHTML = "";
          visibleCategories.forEach(cat => {
            let sectionHTML = `<h2 class="text-xl font-semibold text-blue-600 mb-2 border-b pb-1">${cat}</h2>`;
            categories[cat].forEach(p => { const originalIndex = prompts.findIndex(item => item === p); sectionHTML += createPromptHTML(p, originalIndex); });
            promptList.innerHTML += `<div>${sectionHTML}</div>`;
          });
          const currentFilterValue = categoryFilter.value;
          categoryFilter.innerHTML = '<option value="all">T·∫•t c·∫£ danh m·ª•c</option>';
          Object.keys(categories).sort().forEach(cat => { categoryFilter.innerHTML += `<option value="${cat}">${cat}</option>`; });
          categoryFilter.value = currentFilterValue;
          renderPagination(totalPages);
        }
        function renderPagination(totalPages) { const pagination = document.getElementById("pagination"); pagination.innerHTML = ""; if (totalPages <= 1) return; for (let i = 1; i <= totalPages; i++) { const btn = document.createElement("button"); btn.innerText = i; btn.className = `px-3 py-1 rounded ${i === currentPage ? 'bg-indigo-500 text-white' : 'bg-gray-200'}`; btn.onclick = () => { currentPage = i; renderPrompts(); }; pagination.appendChild(btn); } }
        function addPrompt() { const title = document.getElementById("title").value.trim(); let content = document.getElementById("content").value.trim(); const category = document.getElementById("category").value.trim(); if (!title || !content || !category) { alert("Vui l√≤ng nh·∫≠p ƒë·∫ßy ƒë·ªß ti√™u ƒë·ªÅ, n·ªôi dung v√† danh m·ª•c."); return; } let url = (content.startsWith('http://') || content.startsWith('https://')) ? content : null; const promptData = { title, content, category, url }; if (editingIndex >= 0) { prompts[editingIndex] = promptData; editingIndex = -1; } else { prompts.push(promptData); } document.getElementById("title").value = ""; document.getElementById("content").value = ""; document.getElementById("category").value = ""; currentPage = 1; renderPrompts(); }
        function deletePrompt(index) { if (confirm(`B·∫°n c√≥ ch·∫Øc mu·ªën xo√° prompt "${prompts[index].title}"?`)) { prompts.splice(index, 1); renderPrompts(); } }
        function editPrompt(index) { const p = prompts[index]; document.getElementById("title").value = p.title; document.getElementById("content").value = p.content; document.getElementById("category").value = p.category; editingIndex = index; document.querySelector('#modal-content-wrapper').scrollTop = 0; }
        function askAI(index) { const promptContent = prompts[index].content; sendPromptToAI(promptContent); }
        function exportPrompts() { if(prompts.length === 0) { alert("Kh√¥ng c√≥ prompt n√†o ƒë·ªÉ xu·∫•t."); return; } const blob = new Blob([JSON.stringify(prompts, null, 2)], { type: "application/json" }); const url = URL.createObjectURL(blob); const a = document.createElement("a"); a.href = url; a.download = "my_prompts.json"; a.click(); URL.revokeObjectURL(url); }
        function importPrompts(event) {
          const file = event.target.files[0]; if (!file) return; const reader = new FileReader();
          reader.onload = (e) => {
            try {
              const imported = JSON.parse(e.target.result); if (!Array.isArray(imported)) throw new Error("File JSON ph·∫£i l√† m·ªôt m·∫£ng.");
              const validPrompts = imported.filter(p => p.title && p.content && p.category); const existingTitles = new Set(prompts.map(p => p.title));
              const newPrompts = validPrompts.filter(p => !existingTitles.has(p.title));
              prompts = prompts.concat(newPrompts); alert(`ƒê√£ nh·∫≠p th√†nh c√¥ng ${newPrompts.length} prompt m·ªõi.`); renderPrompts();
            } catch (err) { alert("L·ªói ƒë·ªçc file JSON: " + err.message); }
          };
          reader.readAsText(file); event.target.value = '';
        }
        function deleteCategory() {
          const catToDelete = document.getElementById("deleteCategoryInput").value.trim(); if (!catToDelete) { alert("Vui l√≤ng nh·∫≠p t√™n danh m·ª•c c·∫ßn xo√°."); return; }
          const originalLength = prompts.length; prompts = prompts.filter(p => p.category !== catToDelete); const numDeleted = originalLength - prompts.length;
          if (numDeleted > 0) { alert(`ƒê√£ xo√° th√†nh c√¥ng ${numDeleted} prompt thu·ªôc danh m·ª•c "${catToDelete}".`); document.getElementById("deleteCategoryInput").value = ""; renderPrompts(); } else { alert(`Kh√¥ng t√¨m th·∫•y danh m·ª•c n√†o c√≥ t√™n "${catToDelete}".`); }
        }

        // --- PH·∫¶N 4: KH·ªûI CH·∫†Y TO√ÄN B·ªò ·ª®NG D·ª§NG ---
        document.addEventListener('DOMContentLoaded', () => {
          renderLogs(); // Kh·ªüi ch·∫°y S·ªï tay b√†i h·ªçc
          setupSpeechRecognition(); // Kh·ªüi ch·∫°y Tr√¨nh qu·∫£n l√Ω Prompt
          ['mic-title', 'mic-content', 'mic-category'].forEach(id => {
            const btn = document.getElementById(id);
            if(btn) btn.addEventListener('click', () => toggleMic(id));
          });
          renderPrompts();
        });
    </script>
</body>
</html>